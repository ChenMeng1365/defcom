
# rsa writeup

本题是RSA问题  
已知pq和p+q, 根据公式可求$\phi$

$$ \\
  p * q = n \\
  \phi(n) = (p-1) * (q-1) = p * q + 1 - (p+q)
$$

message是数字化的明文, 那么`pow(message,e,n)`就是密文, 这是个已知密文和公钥求明文的问题(顺带大数分解破解私钥)

`crypto = pow(message, e, n) = pow(message, e) % n`

对 $$ d = \phi^{-1}(n) $$ 有`message = pow(crypto, d, n)`
求d可以利用gmpy2包中的`gmpy2.invert(e,phi)`快速计算

字符串和数字互相转化可以使用Crypto包中的`long_to_bytes()`

```python
import gmpy2
from Crypto.Util.number import *

e = 65537
n = 18342480149313681940279789853991924160074227353705123791000037595153360890132822642976043006911318813300775758144124577859707975632435139032649556702670023135048503831320161801390564249865504115600338239121335712906379154340921036389483202745048888361130956397321676225041699727764025134754318248326767949524701723711254880703300338370716643321223806945033508046531620369700894246998884995216892420859248500948733665757457759853769514897442476089501694458259725702115344138691391339416669150231594139424356187099232460262565673245276836881136549983249164463959443540223031834742704543660093181265391277706499101245091

# c = pow(message,e,p*q)
c = 4115311985099147874200917135776345246171986273059055544720820110403829182337596879790229046703250442338758806624780031916517150988228964230642798938765523249685198904636041171031995485835455419360444542815767913005797424700165346086013992496844351965354798369987839072785621662325597568332464426369061111689071714274735112059784350098274649687744727805109832667388976077106283604119659317047029300427654535615520607954860066690469472795582127329838109567378204429631410432280271576043665399631750912371110700583657697618138594682515697308139330094258146845711000574756288702099892104424632528920715370304039491891011

# p + q = p_q
p_q = 271004500541155723087811662435599167661707170314941243459742113294836446534768135151965831328308161040694067548590031594088859762631471558441649014322943077505497974025105114738408885013303884142928145360484452860379123294539667707746017836518982581020503504643909469106471902357411737287596866256874301055708
phi = n - p_q + 1

d = gmpy2.invert(e,phi)

m = gmpy2.powmod(c,d,n)

print(long_to_bytes(m)) # flag{f4c9e78c471f05f25ed929b32d74757d}
```
